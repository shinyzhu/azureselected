<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>部署 Java EE 应用到 Azure: 第 2 部分 | Azure 中文精选</title>
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="/azureselected/favicon.ico">
    <meta name="description" content="这是系列文章中的第二篇博客，它将带您逐步了解在 Azure 上运行 Java EE 应用程序的选项。 在这一部分中，我们将 Java EE 应用程序作为 Azure 容器实例上的 Docker 容器运行。">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/azureselected/assets/css/0.styles.fe1e9048.css" as="style"><link rel="preload" href="/azureselected/assets/js/app.8a0b7483.js" as="script"><link rel="preload" href="/azureselected/assets/js/2.8d021b4d.js" as="script"><link rel="preload" href="/azureselected/assets/js/42.91268a34.js" as="script"><link rel="preload" href="/azureselected/assets/js/3.32c85e2e.js" as="script"><link rel="preload" href="/azureselected/assets/js/5.554b9b17.js" as="script"><link rel="prefetch" href="/azureselected/assets/js/10.fa73f6fc.js"><link rel="prefetch" href="/azureselected/assets/js/11.e07babbc.js"><link rel="prefetch" href="/azureselected/assets/js/12.12214fd4.js"><link rel="prefetch" href="/azureselected/assets/js/13.b7275e3f.js"><link rel="prefetch" href="/azureselected/assets/js/14.d6b8a728.js"><link rel="prefetch" href="/azureselected/assets/js/15.31a19f47.js"><link rel="prefetch" href="/azureselected/assets/js/16.c3ccb867.js"><link rel="prefetch" href="/azureselected/assets/js/17.7d290d04.js"><link rel="prefetch" href="/azureselected/assets/js/18.4cc5d13c.js"><link rel="prefetch" href="/azureselected/assets/js/19.01296b5f.js"><link rel="prefetch" href="/azureselected/assets/js/20.84db9ad2.js"><link rel="prefetch" href="/azureselected/assets/js/21.6a1d22b6.js"><link rel="prefetch" href="/azureselected/assets/js/22.b38195a7.js"><link rel="prefetch" href="/azureselected/assets/js/23.53dea98b.js"><link rel="prefetch" href="/azureselected/assets/js/24.67816702.js"><link rel="prefetch" href="/azureselected/assets/js/25.8e0307d1.js"><link rel="prefetch" href="/azureselected/assets/js/26.fb128a8f.js"><link rel="prefetch" href="/azureselected/assets/js/27.e8b0b7a9.js"><link rel="prefetch" href="/azureselected/assets/js/28.e625e9de.js"><link rel="prefetch" href="/azureselected/assets/js/29.aeb087ba.js"><link rel="prefetch" href="/azureselected/assets/js/30.8ef68534.js"><link rel="prefetch" href="/azureselected/assets/js/31.6b43ffde.js"><link rel="prefetch" href="/azureselected/assets/js/32.b2f60498.js"><link rel="prefetch" href="/azureselected/assets/js/33.ef0db925.js"><link rel="prefetch" href="/azureselected/assets/js/34.c990c7e7.js"><link rel="prefetch" href="/azureselected/assets/js/35.177548dd.js"><link rel="prefetch" href="/azureselected/assets/js/36.be924c7e.js"><link rel="prefetch" href="/azureselected/assets/js/37.c4a329a3.js"><link rel="prefetch" href="/azureselected/assets/js/38.88502f70.js"><link rel="prefetch" href="/azureselected/assets/js/39.b70a599f.js"><link rel="prefetch" href="/azureselected/assets/js/4.f7cbda98.js"><link rel="prefetch" href="/azureselected/assets/js/40.af1f7c88.js"><link rel="prefetch" href="/azureselected/assets/js/41.09f3637f.js"><link rel="prefetch" href="/azureselected/assets/js/43.8bc4e597.js"><link rel="prefetch" href="/azureselected/assets/js/44.e75fe39d.js"><link rel="prefetch" href="/azureselected/assets/js/45.36f7e780.js"><link rel="prefetch" href="/azureselected/assets/js/46.d83d96f0.js"><link rel="prefetch" href="/azureselected/assets/js/47.b54cc2ca.js"><link rel="prefetch" href="/azureselected/assets/js/48.9b7655b1.js"><link rel="prefetch" href="/azureselected/assets/js/49.dc3e7585.js"><link rel="prefetch" href="/azureselected/assets/js/50.44491727.js"><link rel="prefetch" href="/azureselected/assets/js/51.b3cc832a.js"><link rel="prefetch" href="/azureselected/assets/js/52.4b3f7433.js"><link rel="prefetch" href="/azureselected/assets/js/53.d0efb5a8.js"><link rel="prefetch" href="/azureselected/assets/js/54.41189e23.js"><link rel="prefetch" href="/azureselected/assets/js/55.0604b61d.js"><link rel="prefetch" href="/azureselected/assets/js/56.d1bb56be.js"><link rel="prefetch" href="/azureselected/assets/js/57.2ae826e1.js"><link rel="prefetch" href="/azureselected/assets/js/58.fcca3b58.js"><link rel="prefetch" href="/azureselected/assets/js/59.3da7d882.js"><link rel="prefetch" href="/azureselected/assets/js/6.ef320c88.js"><link rel="prefetch" href="/azureselected/assets/js/60.3f06229c.js"><link rel="prefetch" href="/azureselected/assets/js/61.6e57367f.js"><link rel="prefetch" href="/azureselected/assets/js/62.3b222c6c.js"><link rel="prefetch" href="/azureselected/assets/js/63.8a7f0932.js"><link rel="prefetch" href="/azureselected/assets/js/7.51b986da.js"><link rel="prefetch" href="/azureselected/assets/js/8.a9358b51.js"><link rel="prefetch" href="/azureselected/assets/js/9.b8eed478.js">
    <link rel="stylesheet" href="/azureselected/assets/css/0.styles.fe1e9048.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/azureselected/zh-cn/" class="home-link router-link-active"><img src="/azureselected/img/logo_azure.svg" alt="Azure 中文精选" class="logo"> <span class="site-name can-hide">Azure 中文精选</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/azureselected/zh-cn/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/azureselected/zh-cn/content/" class="nav-link router-link-active">
  内容列表
</a></div><div class="nav-item"><a href="/azureselected/zh-cn/tags.html" class="nav-link">
  标签
</a></div><div class="nav-item"><a href="https://wj.qq.com/s2/5227985/7213/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  参加翻译
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/azureselected/content/cloud-advocate/2020-01/deploying-java-ee-apps-to-azure-part-2.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/azureselected/zh-cn/content/cloud-advocate/2020-01/deploying-java-ee-apps-to-azure-part-2.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/azureselected/zh-tw/" class="nav-link">
  繁體中文
</a></li></ul></div></div> <a href="https://github.com/shinyzhu/azureselected" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/azureselected/zh-cn/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/azureselected/zh-cn/content/" class="nav-link router-link-active">
  内容列表
</a></div><div class="nav-item"><a href="/azureselected/zh-cn/tags.html" class="nav-link">
  标签
</a></div><div class="nav-item"><a href="https://wj.qq.com/s2/5227985/7213/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  参加翻译
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/azureselected/content/cloud-advocate/2020-01/deploying-java-ee-apps-to-azure-part-2.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/azureselected/zh-cn/content/cloud-advocate/2020-01/deploying-java-ee-apps-to-azure-part-2.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/azureselected/zh-tw/" class="nav-link">
  繁體中文
</a></li></ul></div></div> <a href="https://github.com/shinyzhu/azureselected" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>部署 Java EE 应用到 Azure: 第 2 部分</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/azureselected/zh-cn/content/cloud-advocate/2020-01/deploying-java-ee-apps-to-azure-part-2.html#允许-azure-容器实例访问-postgres-数据库" class="sidebar-link">允许 Azure 容器实例访问 Postgres 数据库</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/azureselected/zh-cn/content/cloud-advocate/2020-01/deploying-java-ee-apps-to-azure-part-2.html#构建和发布镜像到-azure-容器注册表" class="sidebar-link">构建和发布镜像到 Azure 容器注册表</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/azureselected/zh-cn/content/cloud-advocate/2020-01/deploying-java-ee-apps-to-azure-part-2.html#访问jsf前端" class="sidebar-link">访问JSF前端</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/azureselected/zh-cn/content/cloud-advocate/2020-01/deploying-java-ee-apps-to-azure-part-2.html#使用rest-api" class="sidebar-link">使用REST API</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/azureselected/zh-cn/content/cloud-advocate/2020-01/deploying-java-ee-apps-to-azure-part-2.html#清除资源" class="sidebar-link">清除资源</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="部署-java-ee-应用到-azure-第-2-部分"><a href="#部署-java-ee-应用到-azure-第-2-部分" class="header-anchor">#</a> 部署 Java EE 应用到 Azure: 第 2 部分</h1> <div class="content-meta"><hr> <p>原文： <a href="https://medium.com/microsoftazure/deploying-java-ee-apps-to-azure-part-2-37d73d0ee401">https://medium.com/microsoftazure/deploying-java-ee-apps-to-azure-part-2-37d73d0ee401</a></p> <p>作者： Abhishek Gupta | 12/6/2019</p> <p><span>翻译： XtaoBai </span> <span>| 审阅： shinyzhu </span> <span>| 2/9/2020</span></p> <div class="tags-head"><span><a href="/azureselected/zh-cn/tags.html#Java EE">
      Java EE
    </a><a href="/azureselected/zh-cn/tags.html#Azure">
      Azure
    </a><a href="/azureselected/zh-cn/tags.html#IaaS">
      IaaS
    </a><a href="/azureselected/zh-cn/tags.html#Cloud Computing">
      Cloud Computing
    </a><a href="/azureselected/zh-cn/tags.html#Database">
      Database
    </a></span></div> <hr></div> <p>这是系列博客的第二篇，本篇将继续带您逐步了解这种在 Azure 中运行 Java EE 应用的方法。<a href="https://medium.com/microsoftazure/deploying-java-ee-apps-to-azure-part-1-e895284b46d1" target="_blank" rel="noopener noreferrer">第一部分<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 讲述了如何将 Java EE 应用程序部署到一个 <a href="https://azure.microsoft.com/services/virtual-machines/?WT.mc_id=medium-blog-abhishgu" target="_blank" rel="noopener noreferrer">微软 Azure 虚拟机<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 上并使用 <a href="https://azure.microsoft.com/services/postgresql/?WT.mc_id=medium-blog-abhishgu" target="_blank" rel="noopener noreferrer">Azure 数据库 PostgreSQL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的服务作为后台数据库。</p> <p>在这一部分，我们将使用 Java EE 应用程序作为 Docker 容器部署在 <a href="https://azure.microsoft.com/services/container-instances/?WT.mc_id=medium-blog-abhishgu" target="_blank" rel="noopener noreferrer">Azure 容器实例<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>上。在这个博客中使用的例子中建立了一个简单的三层应用程序，使用了Java EE 8 规范，如 JAX-RS，EJB，CDI，JPA，JSF，Bean Validation。我们将使用 <a href="https://www.payara.fish/" target="_blank" rel="noopener noreferrer">Payara 服务器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 部署应用并使用关系型数据库 <a href="https://www.postgresql.org/" target="_blank" rel="noopener noreferrer">PostgreSQL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 。</p> <p><img src="https://miro.medium.com/max/980/1*-gOAml8lPYXSaU5clFltdQ.png" alt="img"></p> <p>在本教程中，我们将介绍：</p> <ul><li>在Azure上建立Postgres</li> <li>Dockerize Java EE 应用程序并设置 Azure 容器注册表来存储 Docker 镜像</li> <li>应用程序部署到 Azure 容器实例</li> <li>探索其功能</li></ul> <blockquote><p><em>通过少量调整，在该教程中使用的应用程序已被</em> <a href="https://twitter.com/reza_rahman" target="_blank" rel="noopener noreferrer"><em>Reza Rahman</em><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <em>改编为</em> <a href="https://github.com/m-reza-rahman/javaee-azure/tree/master/javaee" target="_blank" rel="noopener noreferrer"><em>一个项目</em><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></blockquote> <hr> <h1 id="先决条件"><a href="#先决条件" class="header-anchor">#</a> 先决条件</h1> <p>你需要一个 <a href="https://docs.microsoft.com/azure/?WT.mc_id=medium-blog-abhishgu" target="_blank" rel="noopener noreferrer">微软 Azure 账号<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 以及 <a href="https://docs.microsoft.com/cli/azure/?view=azure-cli-latest&amp;WT.mc_id=medium-blog-abhishgu" target="_blank" rel="noopener noreferrer">Azure CLI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来完成这个教程。</p> <p>如果你没有一个 Azure 账号， <a href="https://azure.microsoft.com/free/?WT.mc_id=medium-blog-abhishgu" target="_blank" rel="noopener noreferrer">可以点击并免费注册<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>！ Azure CLI 是一个管理 Azure 资源的跨平台的命令行工具 - 请使用<a href="https://docs.microsoft.com/cli/azure/install-azure-cli?view=azure-cli-latest&amp;WT.mc_id=medium-blog-abhishgu" target="_blank" rel="noopener noreferrer">这些说明<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>安装。</p> <h1 id="首先第一件事情"><a href="#首先第一件事情" class="header-anchor">#</a> 首先第一件事情...</h1> <p>使用 Azure CLI 设置将用于本教程的 Azure 订阅 ID。</p> <p>设置Azure 订阅 ID</p> <div class="language- extra-class"><pre class="language-text"><code>export AZURE_SUBSCRIPTION_ID=[to be filled]
az account set --subscription $AZURE_SUBSCRIPTION_ID
</code></pre></div><p>创建一个含所有服务（资源）的包，其中一部分作为本教程的资源组。资源组是像储存着相关资源 Azure solution 的逻辑容器。资源组包含着你想要管理的资源。</p> <p>创建资源组</p> <div class="language- extra-class"><pre class="language-text"><code>export AZURE_RESOURCE_GROUP_NAME=[to be filled]
export AZURE_LOCATION=[to be filled]
az group create --name $AZURE_RESOURCE_GROUP_NAME --location $AZURE_LOCATION
</code></pre></div><hr> <h1 id="在azure上安装postgres"><a href="#在azure上安装postgres" class="header-anchor">#</a> 在Azure上安装Postgres</h1> <p><a href="https://docs.microsoft.com/azure/postgresql/?WT.mc_id=medium-blog-abhishgu" target="_blank" rel="noopener noreferrer">Azure Database for PostgreSQL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一个建立在开源的 <a href="https://www.postgresql.org/" target="_blank" rel="noopener noreferrer">Postgres 数据库引擎<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 关系型数据库服务。 这是一个完全托管型的数据库服务，提供两种部署选项可用， 作为<a href="https://docs.microsoft.com/azure/postgresql/concepts-servers?WT.mc_id=medium-blog-abhishgu" target="_blank" rel="noopener noreferrer">作为单一的服务器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 或者是作为 <a href="https://docs.microsoft.com/azure/postgresql/concepts-hyperscale-nodes?WT.mc_id=medium-blog-abhishgu" target="_blank" rel="noopener noreferrer">一个超大规模 (Citus) 集群<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p><em>在这次教程中我们将使用 “单一服务器” 选项</em></p></blockquote> <p>我们将使用 <code>az postgres server create</code> 命令在Azure上创建一个Postgres服务器实例。首先，设置了一些服务器的属性，如名称、管理员账号等等。</p> <div class="language- extra-class"><pre class="language-text"><code>export AZURE_POSTGRES_SERVER_NAME=[to be filled]
export AZURE_POSTGRES_ADMIN_USER=[to be filled]
export AZURE_POSTGRES_ADMIN_PASSWORD=[to be filled]
export SKU=B_Gen5_1
export STORAGE=5120
</code></pre></div><blockquote><p><em>对于存储和SKU选项，请参阅</em> <a href="https://docs.microsoft.com/azure/postgresql/concepts-pricing-tiers?WT.mc_id=medium-blog-abhishgu" target="_blank" rel="noopener noreferrer"><em>这篇文档</em><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>然后调用命令来启动数据库实例的创建：</p> <div class="language- extra-class"><pre class="language-text"><code>az postgres server create --resource-group $AZURE_RESOURCE_GROUP_NAME --name $AZURE_POSTGRES_SERVER_NAME  --location $AZURE_LOCATION --admin-user $AZURE_POSTGRES_ADMIN_USER --admin-password $AZURE_POSTGRES_ADMIN_PASSWORD --storage-size $STORAGE --sku-name $SKU
</code></pre></div><p>该配置将需要几分钟的时间。</p> <p>要检查你刚才供应的Postgres数据库实例的详细信息，调用 <code>az postgres server show</code> 命令：</p> <div class="language- extra-class"><pre class="language-text"><code>az postgres server show --resource-group $AZURE_RESOURCE_GROUP_NAME --name $AZURE_POSTGRES_SERVER_NAME
</code></pre></div><p>你应该得到一个JSON响应。请记下 <code>fullyQualifiedDomainName</code> 属性的值，你将稍后使用它连接到Postgres的实例。</p> <blockquote><p><em>应该是以下格式：</em><code>* [AZURE_POSTGRES_DB_NAME] .postgres.database.azure.com *</code></p></blockquote> <h2 id="允许-azure-容器实例访问-postgres-数据库"><a href="#允许-azure-容器实例访问-postgres-数据库" class="header-anchor">#</a> 允许 Azure 容器实例访问 Postgres 数据库</h2> <p>在后面的文章中，我们将看到如何将应用程序部署到 <a href="https://docs.microsoft.com/azure/container-instances/?WT.mc_id=medium-blog-abhishgu" target="_blank" rel="noopener noreferrer">Azure 容器实例<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。但是，Postgres 数据库并不是默认外部服务访问。我们将使用 <code>az postgres server firewall-rule create</code> 命令创建防火墙规则明确允许 Azure 的服务来访问 Postgres 的实例 - 这将允许部署 Azure 容器实例内的 Postgres 的通信的 JavaEE 应用。</p> <div class="language- extra-class"><pre class="language-text"><code>export FIREWALL_RULE_NAME=AllowJavaEECafeAppOnACIaz postgres server firewall-rule create --resource-group $AZURE_RESOURCE_GROUP_NAME --server-name $AZURE_POSTGRES_SERVER_NAME --start-ip-address=0.0.0.0 --end-ip-address=0.0.0.0 --name $FIREWALL_RULE_NAME
</code></pre></div><blockquote><p><em>此设置允许从 Azure 网络内的所有IP网络连接。供生产使用，尝试配置最严格的防火墙规则可能</em></p></blockquote> <hr> <h1 id="安装-azure-容器注册表"><a href="#安装-azure-容器注册表" class="header-anchor">#</a> 安装 Azure 容器注册表</h1> <p>Azure 容器注册表是一个管理私人 Docker 注册服务的用来存储和管理的私人 Docker 容器的镜像（它基于开源的 Docker 注册表2.0）。您可以使用 Azure 容器注册表与您现有容器的开发和部署管道或者使用 <a href="https://docs.microsoft.com/azure/container-registry/container-registry-tasks-overview?WT.mc_id=medium-blog-abhishgu" target="_blank" rel="noopener noreferrer">Azure容器注册表任务<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 在 Azure 构建容器的镜像。您可以构建点播，或构建完全自动的触发器，如源代码提交和基本图像更新。</p> <p>让我们创建一个注册表存储 Docker 镜像的 JavaEE 应用，使用 <code>az acr create</code> 命令。</p> <div class="language- extra-class"><pre class="language-text"><code>export ACR_NAME=javaeecafe-acraz acr create --resource-group $AZURE_RESOURCE_GROUP_NAME --name $ACR_NAME --sku Basic --admin-enabled true
</code></pre></div><blockquote><p><em>我们使用的是</em><code>*Basic*</code> <em>SKU。有效值是：<code>*Basic*</code></em>,* <code>*Classic*</code><em>,</em> <code>*Premium*</code><em>,</em> <code>*Standard*</code></p></blockquote> <p>一旦创建它，​​您可以登录到注册表，并检查登录服务器</p> <div class="language- extra-class"><pre class="language-text"><code>az acr login --name $ACR_NAME
az acr show --name $ACR_NAME --query loginServer --output table
</code></pre></div><blockquote><p><em>你很快就会使用ACR登录服务器名。它的值为如下格式：</em> <code>* [ACR_NAME] .azurecr.io *</code></p></blockquote> <hr> <h1 id="安装并准备应用镜像"><a href="#安装并准备应用镜像" class="header-anchor">#</a> 安装并准备应用镜像</h1> <p>克隆Git仓库</p> <div class="language- extra-class"><pre class="language-text"><code>git clone https://github.com/abhirockzz/javaee-on-azure-caas
cd javaee-on-azure-caas
</code></pre></div><p>您需要输入 Postgres 的连接信息以 在<code>web.xml</code>中提交贡献。</p> <blockquote><p><em>你可以在</em> <code>*javaee-on-azure-iaas/src/main/webapp/WEB-INF*</code><em>下找到</em> <code>*web.xml*</code> <em>文件</em></p></blockquote> <p>格式如下：</p> <div class="language- extra-class"><pre class="language-text"><code>jdbc:postgresql://[POSTGRES_FQDN]:5432/postgres?user=[AZURE_POSTGRES_ADMIN_USER]@[AZURE_POSTGRES_SERVER_NAME]&amp;amp;password=[AZURE_POSTGRES_ADMIN_PASSWORD]&amp;amp;sslmode=require
</code></pre></div><p>以下是一部分形成 JDBC URL 的列表占位符：</p> <ul><li><code>POSTGRES_FQDN</code> 值为 <code>fullyQualifiedDomainName</code></li> <li><code>AZURE_POSTGRES_ADMIN_USER</code> + 管理员用户名 用于规定 PG</li> <li><code>AZURE_POSTGRES_SERVER_NAME</code> + 用户名称 用来规定 PG</li> <li><code>AZURE_POSTGRES_ADMIN_PASSWORD</code> + 管理员密码 用于规定 PG</li></ul> <p>设置所需的值</p> <div class="language- extra-class"><pre class="language-text"><code>export POSTGRES_FQDN=
export AZURE_POSTGRES_ADMIN_USER=
export AZURE_POSTGRES_SERVER_NAME=
export AZURE_POSTGRES_ADMIN_PASSWORD=
</code></pre></div><p>只需使用这些命令来代替<code>web.xml</code>内容</p> <div class="language- extra-class"><pre class="language-text"><code>export FILE_NAME=javaee-on-azure-iaas/src/main/webapp/WEB-INF/web.xmlsed -i 's/POSTGRES_FQDN/'&quot;$POSTGRES_FQDN&quot;'/g' $FILE_NAME
sed -i 's/AZURE_POSTGRES_SERVER_NAME/'&quot;$AZURE_POSTGRES_SERVER_NAME&quot;'/g' $FILE_NAME
sed -i 's/AZURE_POSTGRES_ADMIN_USER/'&quot;$AZURE_POSTGRES_ADMIN_USER&quot;'/g' $FILE_NAME
sed -i 's/AZURE_POSTGRES_ADMIN_PASSWORD/'&quot;$AZURE_POSTGRES_ADMIN_PASSWORD&quot;'/g' $FILE_NAME
</code></pre></div><p>这里是<code></code>部分形式的案例：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;data-source&gt;
        &lt;name&gt;java:global/JavaEECafeDB&lt;/name&gt;
        &lt;class-name&gt;org.postgresql.ds.PGPoolingDataSource&lt;/class-name&gt;
        &lt;url&gt;jdbc:postgresql://foobar-pg.postgres.database.azure.com:5432/postgres?user=foobar@foobar-pg&amp;amp;password=foobarbaz&amp;amp;sslmode=require&lt;/url&gt;
&lt;/data-source&gt;
</code></pre></div><p>应用程序配置好了。现在让我们建立它！</p> <div class="language- extra-class"><pre class="language-text"><code>mvn clean install
</code></pre></div><p>你应该有这个WAR文件可用。确认下吧</p> <div class="language- extra-class"><pre class="language-text"><code>ls -lrt target | grep javaee-cafe.war
</code></pre></div><h2 id="构建和发布镜像到-azure-容器注册表"><a href="#构建和发布镜像到-azure-容器注册表" class="header-anchor">#</a> 构建和发布镜像到 Azure 容器注册表</h2> <p>我们的应用程序神器（<code>WAR</code>文件）已准备就绪。现在，我们可以建立Docker 镜像并将其应用到Azure容器注册表。这里可用快速浏览一下<code>Dockerfile</code>用于创建镜像。</p> <div class="language- extra-class"><pre class="language-text"><code>FROM payara/server-full
COPY target/javaee-cafe.war $DEPLOY_DIR
RUN wget https://jdbc.postgresql.org/download/postgresql-42.2.8.jar
RUN cp /opt/payara/postgresql-42.2.8.jar ${PAYARA_DIR}/glassfish/domains/${DOMAIN_NAME}/lib &amp;&amp; rm /opt/payara/postgresql-42.2.8.jar
EXPOSE 8080
</code></pre></div><p>它建立在<code>payara/server-full</code>，从那里可自动检测和部署，下载Postgres的JDBC驱动程序，并将其放置在适当的位置为副本的<code>WAR</code>file到一个文件夹 Payara 应用服务器。就是它！</p> <div class="language- extra-class"><pre class="language-text"><code>export DOCKER_IMAGE=javaee-cafe
docker build -t $DOCKER_IMAGE .
docker tag $DOCKER_IMAGE $ACR_NAME.azurecr.io/$DOCKER_IMAGE
</code></pre></div><p>发布镜像：</p> <div class="language- extra-class"><pre class="language-text"><code>docker push $ACR_NAME.azurecr.io/$DOCKER_IMAGE
</code></pre></div><p>使用 <code>az acr repository list</code> 命令来确认:</p> <div class="language- extra-class"><pre class="language-text"><code>az acr repository list --name $ACR_NAME --output table
</code></pre></div><hr> <h1 id="将应用程序部署到-azure-容器实例"><a href="#将应用程序部署到-azure-容器实例" class="header-anchor">#</a> 将应用程序部署到 Azure 容器实例</h1> <p>Azure 容器实例允许你在 Azure 中运行容器，而无需管理任何虚拟机，或者采用更高级别的服务。这是一个可以在隔离容器中，如简单的应用程序、自动化任务、建立工作运行，在任何场景下的解决方案。对于您需要完整的容器业务流程，包括跨多个容器，自动缩放服务发现和协调的应用升级的情况，请看看 <a href="https://azure.microsoft.com/services/kubernetes-service/?WT.mc_id=medium-blog-abhishgu" target="_blank" rel="noopener noreferrer">Azure Kubernetes Service (AKS)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>我们现在准备部署 JavaEE 应用到 Azure 容器实例。当你创建一个容器实例，你可以指定自定义DNS名称标签来让你的应用程序是在 <a href="http://customlabel.azureregion.azurecontainer.io/" target="_blank" rel="noopener noreferrer"><em>customlabel.azureregion.azurecontainer.io</em><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>可获得的。</p> <div class="language- extra-class"><pre class="language-text"><code>export ACI_CONTAINER_NAME=javaee-cafe
export DNS_NAME_LABEL=javaee-cafe
</code></pre></div><p>我们需要 Azure 容器注册表的密码来运行在 Azure 容器实例中的 Docker 镜像。</p> <div class="language- extra-class"><pre class="language-text"><code>az acr credential show --name $ACR_NAME
</code></pre></div><p>在下面输入命令来创建容器并输入密码（上面获得的）提示时：</p> <div class="language- extra-class"><pre class="language-text"><code>az container create --resource-group $AZURE_RESOURCE_GROUP_NAME --name $ACI_CONTAINER_NAME --image $ACR_NAME.azurecr.io/$DOCKER_IMAGE --dns-name-label $DNS_NAME_LABEL --registry-username $ACR_NAME --ports 8080
</code></pre></div><blockquote><p><code>*--ports 8080 *</code> <em>确保我们能够从端口</em> <code>* 8080 *</code><em>访问应用程序。这是因为 Payara 应用服务器默认从</em><code>* 8080 *</code><em>提供端口的HTTP流量。</em></p></blockquote> <p>部署将需要一段时间。这时，您可以跟踪使用日志：</p> <div class="language- extra-class"><pre class="language-text"><code>az container attach -g $AZURE_RESOURCE_GROUP_NAME -n $ACI_CONTAINER_NAME
</code></pre></div><p>您应该看到日志消息显示 <code>JavaEE-cafe</code> 应用的成功部署</p> <div class="language- extra-class"><pre class="language-text"><code>[yyyy-mm-ddT13:34:21.317+0000] [Payara 5.193] [INFO] [NCLS-DEPLOYMENT-02035] [javax.enterprise.system.tools.deployment.autodeploy] [tid: _ThreadID=104 _ThreadName=payara-executor-service-scheduled-task] [timeMillis: 1574084061317] [levelValue: 800] [[
    [AutoDeploy] Successfully autodeployed : /home/abhishgu/payara5/glassfish/domains/domain1/autodeploy/javaee-cafe.war.]]
</code></pre></div><hr> <h1 id="探索应用"><a href="#探索应用" class="header-anchor">#</a> 探索应用</h1> <h2 id="访问jsf前端"><a href="#访问jsf前端" class="header-anchor">#</a> 访问JSF前端</h2> <p>使用浏览器访问<code>http://[APP_FQDN]:8080/javaee-cafe</code>。您可以使用用户界面来创建，删除和查看 coffees。</p> <p>在<code>APP_FQDN</code>只不过是DNS标签和 Azure region 的组合，如 <code>http://javaee-cafe.southeastasia.azurecontainer.io:8080/javaee-cafe</code></p> <p><img src="https://miro.medium.com/max/5944/1*rbEWA7qQYoqUKAtCfqLdZQ.png" alt="img"></p> <p><em>Java EE cafe应用页面</em></p> <h2 id="使用rest-api"><a href="#使用rest-api" class="header-anchor">#</a> 使用REST API</h2> <p>该应用程序还公开一个 REST API 用于创建，删除和列出 coffees。</p> <div class="language- extra-class"><pre class="language-text"><code>export JAVAEE_ACI_REST=http://javaee-cafe.southeastasia.azurecontainer.io:8080/javaee-cafe/rest/coffees
</code></pre></div><p>创建 coffees</p> <div class="language- extra-class"><pre class="language-text"><code>curl -X POST $JAVAEE_ACI_REST:8080/javaee-cafe/rest/coffees -d '{&quot;name&quot;:&quot;cappuccino&quot;,&quot;price&quot;:&quot;10&quot;}' -H &quot;Content-Type: application/json&quot;curl -X POST $JAVAEE_ACI_REST:8080/javaee-cafe/rest/coffees -d '{&quot;name&quot;:&quot;caffe-latte&quot;,&quot;price&quot;:&quot;15&quot;}' -H &quot;Content-Type: application/json&quot;
</code></pre></div><p>获得所有coffees</p> <div class="language- extra-class"><pre class="language-text"><code>curl -H &quot;Accept: application/json&quot; $JAVAEE_ACI_REST:8080/javaee-cafe/rest/coffees
</code></pre></div><p>你应该看到一个 JSON 响应列出你刚才添加的 coffee 选项</p> <p>通过 ID 获取 coffee</p> <div class="language- extra-class"><pre class="language-text"><code>curl -H &quot;Accept: application/json&quot; $JAVAEE_ACI_REST:8080/javaee-cafe/rest/coffees/1
</code></pre></div><p>通过 ID 删除 coffee</p> <div class="language- extra-class"><pre class="language-text"><code>curl -X DELETE $JAVAEE_ACI_REST:8080/javaee-cafe/rest/coffees/1curl -H &quot;Accept: application/json&quot; $JAVAEE_ACI_REST:8080/javaee-cafe/rest/coffees
</code></pre></div><p>注意到 <code>cappiccino</code> 现在被删除了</p> <h2 id="清除资源"><a href="#清除资源" class="header-anchor">#</a> 清除资源</h2> <p>一旦您完成探索应用程序，你可以删除该资源。因为我们使用了资源组，执行一个命令很容易实现。</p> <blockquote><p><em>请注意，这将删除所有的资源，其中包括你的教程（ Azure 容器注册表，Postgres等）和其他你放在资源组里面的其他服务实例。</em></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>az group delete --name $AZURE_RESOURCE_GROUP_NAME
</code></pre></div><hr> <h1 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h1> <p>您了解了如何利用 Docker 容器来打包并配置 Azure 容器实例的应用程序，并使用托管数据库来提供长期持久服务。</p> <p>第三部分将介绍<a href="https://kubernetes.io/" target="_blank" rel="noopener noreferrer">Kubernetes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 作为我们的 Java EE 应用部署平台。敬请关注！</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/shinyzhu/azureselected/edit/master/zh-cn/content/cloud-advocate/2020-01/deploying-java-ee-apps-to-azure-part-2.md" target="_blank" rel="noopener noreferrer">在 GitHub 编辑本页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">最近更新于:</span> <span class="time">3/9/2020, 8:31:50 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/azureselected/zh-cn/content/cloud-advocate/2019-12/deploying-java-ee-apps-to-azure-part-1.html" class="prev">
        部署 Java EE 应用到 Azure: 第 1 部分
      </a></span> <span class="next"><a href="/azureselected/zh-cn/content/cloud-advocate/2020-01/deploying-java-ee-apps-to-azure-part-3.html">
        Deploying Java EE apps to Azure: Part 3
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/azureselected/assets/js/app.8a0b7483.js" defer></script><script src="/azureselected/assets/js/2.8d021b4d.js" defer></script><script src="/azureselected/assets/js/42.91268a34.js" defer></script><script src="/azureselected/assets/js/3.32c85e2e.js" defer></script><script src="/azureselected/assets/js/5.554b9b17.js" defer></script>
  </body>
</html>
