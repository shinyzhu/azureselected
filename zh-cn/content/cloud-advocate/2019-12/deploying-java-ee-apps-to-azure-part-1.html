<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>部署 Java EE 应用到 Azure: 第 1 部分 | Azure 中文精选</title>
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="/azureselected/favicon.ico">
    <meta name="description" content="这是一系列博客的第一篇，它将引导您逐步了解在Azure上运行Java EE应用程序的一种选择。 我们将采用最基本的方法将Java EE应用程序部署到在Microsoft Azure上的虚拟机中设置的应用程序服务器上，并将Azure Database for PostgreSQL服务作为后端数据库。 本质上，这是IaaS（Azure VM）与PaaS（Azure上的托管PostgreSQL）的组合。">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/azureselected/assets/css/0.styles.fe1e9048.css" as="style"><link rel="preload" href="/azureselected/assets/js/app.8a0b7483.js" as="script"><link rel="preload" href="/azureselected/assets/js/2.8d021b4d.js" as="script"><link rel="preload" href="/azureselected/assets/js/39.b70a599f.js" as="script"><link rel="preload" href="/azureselected/assets/js/3.32c85e2e.js" as="script"><link rel="preload" href="/azureselected/assets/js/5.554b9b17.js" as="script"><link rel="prefetch" href="/azureselected/assets/js/10.fa73f6fc.js"><link rel="prefetch" href="/azureselected/assets/js/11.e07babbc.js"><link rel="prefetch" href="/azureselected/assets/js/12.12214fd4.js"><link rel="prefetch" href="/azureselected/assets/js/13.b7275e3f.js"><link rel="prefetch" href="/azureselected/assets/js/14.d6b8a728.js"><link rel="prefetch" href="/azureselected/assets/js/15.31a19f47.js"><link rel="prefetch" href="/azureselected/assets/js/16.c3ccb867.js"><link rel="prefetch" href="/azureselected/assets/js/17.7d290d04.js"><link rel="prefetch" href="/azureselected/assets/js/18.4cc5d13c.js"><link rel="prefetch" href="/azureselected/assets/js/19.01296b5f.js"><link rel="prefetch" href="/azureselected/assets/js/20.84db9ad2.js"><link rel="prefetch" href="/azureselected/assets/js/21.6a1d22b6.js"><link rel="prefetch" href="/azureselected/assets/js/22.b38195a7.js"><link rel="prefetch" href="/azureselected/assets/js/23.53dea98b.js"><link rel="prefetch" href="/azureselected/assets/js/24.67816702.js"><link rel="prefetch" href="/azureselected/assets/js/25.8e0307d1.js"><link rel="prefetch" href="/azureselected/assets/js/26.fb128a8f.js"><link rel="prefetch" href="/azureselected/assets/js/27.e8b0b7a9.js"><link rel="prefetch" href="/azureselected/assets/js/28.e625e9de.js"><link rel="prefetch" href="/azureselected/assets/js/29.aeb087ba.js"><link rel="prefetch" href="/azureselected/assets/js/30.8ef68534.js"><link rel="prefetch" href="/azureselected/assets/js/31.6b43ffde.js"><link rel="prefetch" href="/azureselected/assets/js/32.b2f60498.js"><link rel="prefetch" href="/azureselected/assets/js/33.ef0db925.js"><link rel="prefetch" href="/azureselected/assets/js/34.c990c7e7.js"><link rel="prefetch" href="/azureselected/assets/js/35.177548dd.js"><link rel="prefetch" href="/azureselected/assets/js/36.be924c7e.js"><link rel="prefetch" href="/azureselected/assets/js/37.c4a329a3.js"><link rel="prefetch" href="/azureselected/assets/js/38.88502f70.js"><link rel="prefetch" href="/azureselected/assets/js/4.f7cbda98.js"><link rel="prefetch" href="/azureselected/assets/js/40.af1f7c88.js"><link rel="prefetch" href="/azureselected/assets/js/41.09f3637f.js"><link rel="prefetch" href="/azureselected/assets/js/42.91268a34.js"><link rel="prefetch" href="/azureselected/assets/js/43.8bc4e597.js"><link rel="prefetch" href="/azureselected/assets/js/44.e75fe39d.js"><link rel="prefetch" href="/azureselected/assets/js/45.36f7e780.js"><link rel="prefetch" href="/azureselected/assets/js/46.d83d96f0.js"><link rel="prefetch" href="/azureselected/assets/js/47.b54cc2ca.js"><link rel="prefetch" href="/azureselected/assets/js/48.9b7655b1.js"><link rel="prefetch" href="/azureselected/assets/js/49.dc3e7585.js"><link rel="prefetch" href="/azureselected/assets/js/50.44491727.js"><link rel="prefetch" href="/azureselected/assets/js/51.b3cc832a.js"><link rel="prefetch" href="/azureselected/assets/js/52.4b3f7433.js"><link rel="prefetch" href="/azureselected/assets/js/53.d0efb5a8.js"><link rel="prefetch" href="/azureselected/assets/js/54.41189e23.js"><link rel="prefetch" href="/azureselected/assets/js/55.0604b61d.js"><link rel="prefetch" href="/azureselected/assets/js/56.d1bb56be.js"><link rel="prefetch" href="/azureselected/assets/js/57.2ae826e1.js"><link rel="prefetch" href="/azureselected/assets/js/58.fcca3b58.js"><link rel="prefetch" href="/azureselected/assets/js/59.3da7d882.js"><link rel="prefetch" href="/azureselected/assets/js/6.ef320c88.js"><link rel="prefetch" href="/azureselected/assets/js/60.3f06229c.js"><link rel="prefetch" href="/azureselected/assets/js/61.6e57367f.js"><link rel="prefetch" href="/azureselected/assets/js/62.3b222c6c.js"><link rel="prefetch" href="/azureselected/assets/js/63.8a7f0932.js"><link rel="prefetch" href="/azureselected/assets/js/7.51b986da.js"><link rel="prefetch" href="/azureselected/assets/js/8.a9358b51.js"><link rel="prefetch" href="/azureselected/assets/js/9.b8eed478.js">
    <link rel="stylesheet" href="/azureselected/assets/css/0.styles.fe1e9048.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/azureselected/zh-cn/" class="home-link router-link-active"><img src="/azureselected/img/logo_azure.svg" alt="Azure 中文精选" class="logo"> <span class="site-name can-hide">Azure 中文精选</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/azureselected/zh-cn/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/azureselected/zh-cn/content/" class="nav-link router-link-active">
  内容列表
</a></div><div class="nav-item"><a href="/azureselected/zh-cn/tags.html" class="nav-link">
  标签
</a></div><div class="nav-item"><a href="https://wj.qq.com/s2/5227985/7213/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  参加翻译
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/azureselected/content/cloud-advocate/2019-12/deploying-java-ee-apps-to-azure-part-1.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/azureselected/zh-cn/content/cloud-advocate/2019-12/deploying-java-ee-apps-to-azure-part-1.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/azureselected/zh-tw/" class="nav-link">
  繁體中文
</a></li></ul></div></div> <a href="https://github.com/shinyzhu/azureselected" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/azureselected/zh-cn/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/azureselected/zh-cn/content/" class="nav-link router-link-active">
  内容列表
</a></div><div class="nav-item"><a href="/azureselected/zh-cn/tags.html" class="nav-link">
  标签
</a></div><div class="nav-item"><a href="https://wj.qq.com/s2/5227985/7213/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  参加翻译
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/azureselected/content/cloud-advocate/2019-12/deploying-java-ee-apps-to-azure-part-1.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/azureselected/zh-cn/content/cloud-advocate/2019-12/deploying-java-ee-apps-to-azure-part-1.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/azureselected/zh-tw/" class="nav-link">
  繁體中文
</a></li></ul></div></div> <a href="https://github.com/shinyzhu/azureselected" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>部署 Java EE 应用到 Azure: 第 1 部分</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/azureselected/zh-cn/content/cloud-advocate/2019-12/deploying-java-ee-apps-to-azure-part-1.html#允许虚拟机访问-postgres-数据库" class="sidebar-link">允许虚拟机访问 Postgres 数据库</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/azureselected/zh-cn/content/cloud-advocate/2019-12/deploying-java-ee-apps-to-azure-part-1.html#安装所需工具集" class="sidebar-link">安装所需工具集</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/azureselected/zh-cn/content/cloud-advocate/2019-12/deploying-java-ee-apps-to-azure-part-1.html#安装-payara-服务器" class="sidebar-link">安装 Payara 服务器</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/azureselected/zh-cn/content/cloud-advocate/2019-12/deploying-java-ee-apps-to-azure-part-1.html#访问jsf前端" class="sidebar-link">访问JSF前端</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/azureselected/zh-cn/content/cloud-advocate/2019-12/deploying-java-ee-apps-to-azure-part-1.html#使用-rest-api" class="sidebar-link">使用 REST API</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="部署-java-ee-应用到-azure-第-1-部分"><a href="#部署-java-ee-应用到-azure-第-1-部分" class="header-anchor">#</a> 部署 Java EE 应用到 Azure: 第 1 部分</h1> <div class="content-meta"><hr> <p>原文： <a href="https://medium.com/microsoftazure/deploying-java-ee-apps-to-azure-part-1-e895284b46d1">https://medium.com/microsoftazure/deploying-java-ee-apps-to-azure-part-1-e895284b46d1</a></p> <p>作者： Abhishek Gupta | 11/21/2019</p> <p><span>翻译： HeMinzhang </span> <span>| 审阅： shinyzhu </span> <span>| 12/27/2019</span></p> <div class="tags-head"><span><a href="/azureselected/zh-cn/tags.html#Java EE">
      Java EE
    </a><a href="/azureselected/zh-cn/tags.html#Azure">
      Azure
    </a><a href="/azureselected/zh-cn/tags.html#IaaS">
      IaaS
    </a><a href="/azureselected/zh-cn/tags.html#Cloud Computing">
      Cloud Computing
    </a><a href="/azureselected/zh-cn/tags.html#Database">
      Database
    </a></span></div> <hr></div> <p>基于云的应用程序开发有多种选择，包括传统的 <code>IaaS</code>（基础架构即服务）， <code>PaaS</code>（平台即服务）和 <code>CaaS</code>（ 容器即服务）一直到 <a href="https://kubernetes.io/" target="_blank" rel="noopener noreferrer">Kubernetes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <code>Serverless</code> （无服务器）（也许还有更多我未提及！）。思考实际应用范围，而不是 “一种适合所有模型的方法” ，每种选择都有其优缺点。 最终, 每个场景都是唯一的，最终选择取决于需求 — 但是有很多 &quot;选择&quot; 总是好的!</p> <p><img src="https://miro.medium.com/max/980/0*v9YZMVTbaw9xoV70.png" alt="img"></p> <p>这是系列博客的第一篇，它将带您逐步了解其中一种在 Azure 中运行 Java EE 应用的方法。 我们将采用最基本的方法将 Java EE 应用部署在一个 <a href="https://azure.microsoft.com/services/virtual-machines/?WT.mc_id=azureselected-content-xinglzhu" target="_blank" rel="noopener noreferrer">Azure 虚拟机<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 以及 <a href="https://azure.microsoft.com/services/postgresql/?WT.mc_id=azureselected-content-xinglzhu" target="_blank" rel="noopener noreferrer">Azure PostgreSQL 数据库<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 服务作为后端数据库。本质上, 这是结合 <code>IaaS</code> (Azure 虚拟机) 与 <code>PaaS</code> ( Azure 中托管的 PostgreSQL )</p> <blockquote><p><em>其他选项（例如容器和Kubernetes）将在以后的文章中介绍</em></p></blockquote> <p>本文中使用的示例是一个简单的三层应用程序，该应用使用Java EE 8规范，例如JAX-RS，EJB，CDI，JPA，JSF，Bean验证。 我们将使用 <a href="https://www.payara.fish/" target="_blank" rel="noopener noreferrer">Payara服务器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 部署应用程序，并使用 <a href="https://www.postgresql.org/" target="_blank" rel="noopener noreferrer">PostgreSQL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 用作关系数据库。</p> <p>在本教程中，我们将介绍:</p> <ul><li>Azure 中 Postgres 和虚拟机设置</li> <li>在虚拟机中设置 Payara 服务器</li> <li>配置和安装 Java EE 应用</li> <li>探索其功能</li></ul> <p>除某些微小改动外, 本教程中使用的应用来自  <a href="https://twitter.com/reza_rahman" target="_blank" rel="noopener noreferrer">Reza Rahman<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的 <a href="https://github.com/m-reza-rahman/javaee-azure/tree/master/javaee" target="_blank" rel="noopener noreferrer">此项目<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h1 id="先决条件"><a href="#先决条件" class="header-anchor">#</a> 先决条件</h1> <p>你将需要 <a href="https://docs.microsoft.com/azure/?WT.mc_id=azureselected-content-xinglzhu" target="_blank" rel="noopener noreferrer">微软 Azure 账号<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://docs.microsoft.com/cli/azure/?view=azure-cli-latest&amp;WT.mc_id=azureselected-content-xinglzhu" target="_blank" rel="noopener noreferrer">Azure CLI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来完成本教程。</p> <p>如果没有微软账户, 在此 <a href="https://azure.microsoft.com/free/?WT.mc_id=azureselected-content-xinglzhu" target="_blank" rel="noopener noreferrer">免费注册<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 。Azure CLI 是一个成熟的管理 Azure 资源跨平台命令行 — 请使用 <a href="https://docs.microsoft.com/cli/azure/install-azure-cli?view=azure-cli-latest&amp;WT.mc_id=azureselected-content-xinglzhu" target="_blank" rel="noopener noreferrer">这些指示<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 安装。</p> <h1 id="第一件事情"><a href="#第一件事情" class="header-anchor">#</a> 第一件事情</h1> <p>使用 Azure CLI 设置本教程的 Azure 订阅ID。</p> <p>设置您的Azure订阅ID：</p> <div class="language- extra-class"><pre class="language-text"><code>export AZURE_SUBSCRIPTION_ID=[to be filled]az account set --subscription $AZURE_SUBSCRIPTION_ID
</code></pre></div><p>创建一个资源组，其中将包含您将在本教程中创建的所有服务（资源）。 资源组就像一个逻辑容器，其中包含用于Azure解决方案的相关资源。 资源组包括您要作为组管理的那些资源。</p> <p>创建资源组：</p> <div class="language- extra-class"><pre class="language-text"><code>export AZURE_RESOURCE_GROUP_NAME=[to be filled]
export AZURE_LOCATION=[to be filled]az group create --name $AZURE_RESOURCE_GROUP_NAME --location $AZURE_LOCATION
</code></pre></div><h1 id="在-azure-中安装-postgresql"><a href="#在-azure-中安装-postgresql" class="header-anchor">#</a> 在 Azure 中安装 PostgreSQL</h1> <p><a href="https://docs.microsoft.com/azure/postgresql/?WT.mc_id=azureselected-content-xinglzhu" target="_blank" rel="noopener noreferrer">用于PostgreSQL的Azure数据库<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一个基于开源 <a href="https://www.postgresql.org/" target="_blank" rel="noopener noreferrer">Postgres 数据库引擎<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 关系数据库服务.这是一种完全托管的数据库即服务产品，有两个部署选项可用，作为 <a href="https://docs.microsoft.com/azure/postgresql/concepts-servers?WT.mc_id=azureselected-content-xinglzhu" target="_blank" rel="noopener noreferrer">单一服务器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, 和作为 <a href="https://docs.microsoft.com/azure/postgresql/concepts-hyperscale-nodes?WT.mc_id=azureselected-content-xinglzhu" target="_blank" rel="noopener noreferrer">和超大型 (Citus) 集群<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <blockquote><p><em>在本教程中，我们将使用单服务器选项</em></p></blockquote> <p>我们将使用 <code>az postgres server create</code> 命令在 Azure 中创建 Postgres 服务器实例。 首先, 设置一些服务器属性，例如名称，管理员用户等。</p> <div class="language- extra-class"><pre class="language-text"><code>export AZURE_POSTGRES_SERVER_NAME=[to be filled]
export AZURE_POSTGRES_ADMIN_USER=[to be filled]
export AZURE_POSTGRES_ADMIN_PASSWORD=[to be filled]
export SKU=B_Gen5_1
export STORAGE=5120
</code></pre></div><blockquote><p><em>对于存储和 SKU 选项, 请参考  <a href="https://docs.microsoft.com/azure/postgresql/concepts-pricing-tiers?WT.mc_id=azureselected-content-xinglzhu" target="_blank" rel="noopener noreferrer">该文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</em></p></blockquote> <p>然后, 使用此命令创建并初始化数据库实例：</p> <div class="language- extra-class"><pre class="language-text"><code>az postgres server create --resource-group $AZURE_RESOURCE_GROUP_NAME --name $AZURE_POSTGRES_SERVER_NAME  --location $AZURE_LOCATION --admin-user $AZURE_POSTGRES_ADMIN_USER --admin-password $AZURE_POSTGRES_ADMIN_PASSWORD --storage-size $STORAGE --sku-name $SKU
</code></pre></div><p>设置过程将花费几分钟。</p> <p>使用 <code>az postgres server show</code> 命令，检查刚刚配置的 Postgres 数据库实例的详细信息。</p> <div class="language- extra-class"><pre class="language-text"><code>az postgres server show --resource-group $AZURE_RESOURCE_GROUP_NAME --name $AZURE_POSTGRES_SERVER_NAME
</code></pre></div><p>此时应该得到 JSON 格式响应。请记下 <code>fullyQualifiedDomainName</code> 属性的值，因为稍后将使用它来连接到 Postgres实例。</p> <blockquote><p><em>其格式应该是:</em> <code>*[AZURE_POSTGRES_DB_NAME].postgres.database.azure.com*</code></p></blockquote> <h1 id="在azure中安装虚拟机"><a href="#在azure中安装虚拟机" class="header-anchor">#</a> 在Azure中安装虚拟机</h1> <p>我们将使用 Azure <a href="https://docs.microsoft.com/azure/virtual-machines/?WT.mc_id=azureselected-content-xinglzhu" target="_blank" rel="noopener noreferrer">虚拟机<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 托管 Payara JavaEE 应用程序服务器。具体来说，这将是基于 Ubuntu 的 Linux 虚拟机。</p> <p>首先，设置虚拟机所需的信息：</p> <div class="language- extra-class"><pre class="language-text"><code>export AZURE_VM_NAME=[to be filled]
export AZURE_VM_USER=[to be filled]
export AZURE_VM_PASSWORD=[to be filled]
export VM_IMAGE=UbuntuLTS
</code></pre></div><p>我们将使用 <code>az vm create</code> 命令创建虚拟机实例：</p> <div class="language- extra-class"><pre class="language-text"><code>az vm create --resource-group $AZURE_RESOURCE_GROUP_NAME --name $AZURE_VM_NAME --image $VM_IMAGE --admin-username $AZURE_VM_USER --admin-password $AZURE_VM_PASSWORD
</code></pre></div><p>此虚拟机配置将花费几分钟。</p> <p>使用 <code>az vm list-ip-addresses</code> 命令，获取虚拟机的公共IP地址。</p> <div class="language- extra-class"><pre class="language-text"><code>az vm list-ip-addresses --resource-group $AZURE_RESOURCE_GROUP_NAME --name $AZURE_VM_NAME
</code></pre></div><p>查看 JSON 格式响应 — 检查 <code>publicIpAddresses</code> 部分，并记下 <code>ipAddress</code> 属性的值。 将其配置为环境变量，因为您将在后续步骤中使用它。</p> <div class="language- extra-class"><pre class="language-text"><code>export VM_IP=[to be filled]
</code></pre></div><h2 id="允许虚拟机访问-postgres-数据库"><a href="#允许虚拟机访问-postgres-数据库" class="header-anchor">#</a> 允许虚拟机访问 Postgres 数据库</h2> <p>默认情况下无法访问 Postgres 数据库。 使用 <code>az postgres server firewall-rule create</code> 命令创建防火墙规则，明确允许虚拟机访问 Postgres 实例。这将允许虚拟机内部署的 JavaEE 应用程序与 Postgres 通信。</p> <div class="language- extra-class"><pre class="language-text"><code>export FIREWALL_RULE_NAME=AllowJavaEECafeAppOnVMaz postgres server firewall-rule create --resource-group $AZURE_RESOURCE_GROUP_NAME --server $AZURE_POSTGRES_SERVER_NAME --name $FIREWALL_RULE_NAME --start-ip-address $VM_IP --end-ip-address $VM_IP
</code></pre></div><h1 id="在虚拟机中安装-payara-服务器"><a href="#在虚拟机中安装-payara-服务器" class="header-anchor">#</a> 在虚拟机中安装 Payara 服务器</h1> <p><a href="http://www.payara.fish/" target="_blank" rel="noopener noreferrer">Payara 服务器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是派生自 <a href="https://javaee.github.io/glassfish/" target="_blank" rel="noopener noreferrer">GlassFish<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 开源应用程序服务器，它支持Java EE的可靠和安全部署。 (<a href="https://jakarta.ee/" target="_blank" rel="noopener noreferrer">Jakarta EE<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) 和 <a href="https://microprofile.io/" target="_blank" rel="noopener noreferrer">MicroProfile<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 应用程序可在任何环境中使用：本地，云中或混合环境中。</p> <blockquote><p><em>在</em> <a href="https://github.com/payara/Payara" target="_blank" rel="noopener noreferrer"><em>GitHub</em><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <em>检出（git checkout命令）此项目，或在</em> <a href="https://docs.payara.fish/" target="_blank" rel="noopener noreferrer"><em>文档</em><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <em>了解更多!</em></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>ssh $AZURE_VM_USER@$VM_IP
</code></pre></div><p>提示时输入密码。 登录虚拟机后，请继续以下步骤。</p> <h2 id="安装所需工具集"><a href="#安装所需工具集" class="header-anchor">#</a> 安装所需工具集</h2> <p>在安装Payara服务器之前，我们需要预安装某些配置，例如JDK等。</p> <div class="language- extra-class"><pre class="language-text"><code>sudo apt-get update
sudo apt install openjdk-8-jdk
sudo apt install maven
</code></pre></div><h2 id="安装-payara-服务器"><a href="#安装-payara-服务器" class="header-anchor">#</a> 安装 Payara 服务器</h2> <p>我们使用 Payara 服务器 <code>5.193.1</code> 版本，这是撰写本教程时的最新版本。 该设置仅涉及下载和提取服务器 zip 文件。</p> <div class="language- extra-class"><pre class="language-text"><code>export PAYARA_VERSION=5.193.1wget https://s3-eu-west-1.amazonaws.com/payara.fish/Payara+Downloads/$PAYARA_VERSION/payara-$PAYARA_VERSION.zipsudo apt install unzip
unzip payara-$PAYARA_VERSION.zip
</code></pre></div><p>运行 <code>ls ~/payara5/</code> 进行验证。</p> <p>使用 <code>asadmin</code> 启动服务器。</p> <div class="language- extra-class"><pre class="language-text"><code>~/payara5/bin/asadmin start-domain
</code></pre></div><p>服务器启动将需要一些时间。 您应该看到以下日志：</p> <div class="language- extra-class"><pre class="language-text"><code>Waiting for domain1 to start ..................
Successfully started the domain : domain1
domain  Location: /home/abhishgu/payara5/glassfish/domains/domain1
Log File: /home/abhishgu/payara5/glassfish/domains/domain1/logs/server.log
Admin Port: 4848
Command start-domain executed successfully.
</code></pre></div><h1 id="设置和部署应用程序"><a href="#设置和部署应用程序" class="header-anchor">#</a> 设置和部署应用程序</h1> <p>此时我们已经启动并运行了虚拟机和 Payara 服务器，现在可以部署应用程序了。</p> <p>首先克隆Git存储库：</p> <div class="language- extra-class"><pre class="language-text"><code>git clone https://github.com/abhirockzz/javaee-on-azure-iaasexport APP_FOLDER_NAME=javaee-on-azure-iaas
</code></pre></div><p>需要使用 Azure 中 Postgres 数据库的 JDBC URL 更新 <code>web.xml</code> 文件（在 <code>javaee-on-azure-iaas/src/main/webapp/WEB-INF</code> 下）。 它出现在部分 ``属性` 中，其格式如下：</p> <div class="language- extra-class"><pre class="language-text"><code>jdbc:postgresql://POSTGRES_FQDN:5432/postgres?user=AZURE_POSTGRES_ADMIN_USER@=AZURE_POSTGRES_SERVER_NAME&amp;amp;password=AZURE_POSTGRES_ADMIN_PASSWORD&amp;amp;sslmode=require
</code></pre></div><p>这是构成JDBC URL一部分的占位符列表:</p> <ul><li>Postgres 实例 <code>POSTGRES_FQDN</code> 和 <code>fullyQualifiedDomainName</code> 的值</li> <li><code>AZURE_POSTGRES_ADMIN_USER</code> 和管理员用户名用于配置 PG (Postgres)</li> <li><code>AZURE_POSTGRES_SERVER_NAME</code> 和服务器名称用于配置 PG</li> <li><code>AZURE_POSTGRES_ADMIN_PASSWORD</code> 和管理员密码用于配置 PG</li></ul> <p>设置所需的值：</p> <div class="language- extra-class"><pre class="language-text"><code>export POSTGRES_FQDN=[to be filled]
export AZURE_POSTGRES_ADMIN_USER=[to be filled]
export AZURE_POSTGRES_SERVER_NAME=[to be filled]
export AZURE_POSTGRES_ADMIN_PASSWORD=[to be filled]
</code></pre></div><p>只需使用这些命令即可替换：</p> <div class="language- extra-class"><pre class="language-text"><code>export FILE_NAME=javaee-on-azure-iaas/src/main/webapp/WEB-INF/web.xmlsed -i 's/POSTGRES_FQDN/'&quot;$POSTGRES_FQDN&quot;'/g' $FILE_NAMEsed -i 's/AZURE_POSTGRES_SERVER_NAME/'&quot;$AZURE_POSTGRES_SERVER_NAME&quot;'/g' $FILE_NAMEsed -i 's/AZURE_POSTGRES_ADMIN_USER/'&quot;$AZURE_POSTGRES_ADMIN_USER&quot;'/g' $FILE_NAMEsed -i 's/AZURE_POSTGRES_ADMIN_PASSWORD/'&quot;$AZURE_POSTGRES_ADMIN_PASSWORD&quot;'/g' $FILE_NAME
</code></pre></div><p>如下是 `` 部分的示例：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;data-source&gt;
    &lt;name&gt;java:global/JavaEECafeDB&lt;/name&gt;
    &lt;class-name&gt;org.postgresql.ds.PGPoolingDataSource&lt;/class-name&gt;
    &lt;url&gt;jdbc:postgresql://foobar-pg.postgres.database.azure.com:5432/postgres?user=foobar@foobar-pg&amp;amp;password=foobarbaz&amp;amp;sslmode=require&lt;/url&gt;
&lt;/data-source&gt;
</code></pre></div><p>运行环境已设置完成。 开始构建程序吧！</p> <div class="language- extra-class"><pre class="language-text"><code>mvn clean install -f $APP_FOLDER_NAME/pom.xml
</code></pre></div><p>我们开始确认是否有可用的 WAR 文件：</p> <div class="language- extra-class"><pre class="language-text"><code>ls -lrt $APP_FOLDER_NAME/target | grep javaee-cafe.war
</code></pre></div><p>作为应用程序设置过程的最后一步, 下载 <a href="https://jdbc.postgresql.org/" target="_blank" rel="noopener noreferrer">Postgres JDBC 驱动程序<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 并将其添加到 Payara 服务器。</p> <blockquote><p><em>当前使用驱动版本号</em> <code>*42.2.8*</code></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>export PG_DRIVER_JAR=postgresql-42.2.8.jarwget https://jdbc.postgresql.org/download/$PG_DRIVER_JAR
</code></pre></div><p>调用  <code>asadmin add-library</code> ， 将JAR添加到Payara：</p> <div class="language- extra-class"><pre class="language-text"><code>~/payara5/glassfish/bin/asadmin add-library $PG_DRIVER_JAR
</code></pre></div><p>最后，开始部署WAR文件，将其复制到域 <code>autodeploy</code> 文件夹中：</p> <div class="language- extra-class"><pre class="language-text"><code>cp $APP_FOLDER_NAME/target/javaee-cafe.war ~/payara5/glassfish/domains/domain1/autodeploy
</code></pre></div><p>部署将需要一些时间。 同时，您可以使用以下方法跟踪日志：</p> <div class="language- extra-class"><pre class="language-text"><code>tail -f ~/payara5/glassfish/domains/domain1/logs/server.log
</code></pre></div><p>您应该会看到 <code>javaee-cafe</code> 应用程序的日志消息，提示成功部署：</p> <div class="language- extra-class"><pre class="language-text"><code>[2019-11-18T13:34:21.317+0000] [Payara 5.193] [INFO] [NCLS-DEPLOYMENT-02035] [javax.enterprise.system.tools.deployment.autodeploy] [tid: _ThreadID=104 _ThreadName=payara-executor-service-scheduled-task] [timeMillis: 1574084061317] [levelValue: 800] [[
[AutoDeploy] Successfully autodeployed : /home/abhishgu/payara5/glassfish/domains/domain1/autodeploy/javaee-cafe.war.]]
</code></pre></div><h1 id="探索应用程序"><a href="#探索应用程序" class="header-anchor">#</a> 探索应用程序</h1> <p>现在该测试 JavaEE应用了！ 首先，我们可以使用网络浏览器访问该应用程序。 但是，就像 Postgres 实例一样，默认情况下，托管 Payara 服务器和应用程序的虚拟机也受到保护，即您无法从公共 Internet 访问它。</p> <p>我们需要使用 <code>az vm open-port</code> 创建防火墙规则，使本地计算机可以访问它。 我们只需要公开端口 <code>8080</code> ，因为这是 Payara 服务器使用的默认 HTTP 端口</p> <div class="language- extra-class"><pre class="language-text"><code>az vm open-port --port 8080 --resource-group $AZURE_RESOURCE_GROUP_NAME --name $AZURE_VM_NAME
</code></pre></div><h2 id="访问jsf前端"><a href="#访问jsf前端" class="header-anchor">#</a> 访问JSF前端</h2> <p>使用浏览器打开 <code>http://[ENTER_VM_IP]:8080/javaee-cafe</code>. 你可以使用此图形交换系统创建、删除和列出咖啡（coffees）。</p> <h2 id="使用-rest-api"><a href="#使用-rest-api" class="header-anchor">#</a> 使用 REST API</h2> <p>该应用使用 REST API 同样用于创建、删除和列出咖啡（coffees）。</p> <div class="language- extra-class"><pre class="language-text"><code>export VM_IP=[to be filled]
</code></pre></div><p>创建咖啡：</p> <div class="language- extra-class"><pre class="language-text"><code>curl -X POST $VM_IP:8080/javaee-cafe/rest/coffees -d '{&quot;name&quot;:&quot;cappuccino&quot;,&quot;price&quot;:&quot;10&quot;}' -H &quot;Content-Type: application/json&quot;
curl -X POST $VM_IP:8080/javaee-cafe/rest/coffees -d '{&quot;name&quot;:&quot;caffe-latte&quot;,&quot;price&quot;:&quot;15&quot;}' -H &quot;Content-Type: application/json&quot;
</code></pre></div><p>获取全部咖啡：</p> <div class="language- extra-class"><pre class="language-text"><code>curl -H &quot;Accept: application/json&quot; $VM_IP:8080/javaee-cafe/rest/coffees
</code></pre></div><p>此时应会看到 JSON 格式的响应，列出刚才添加的所有咖啡</p> <p>通过 ID 获取咖啡：</p> <div class="language- extra-class"><pre class="language-text"><code>curl -H &quot;Accept: application/json&quot; $VM_IP:8080/javaee-cafe/rest/coffees/1
</code></pre></div><p>通过 ID 删除咖啡：</p> <div class="language- extra-class"><pre class="language-text"><code>curl -X DELETE $VM_IP:8080/javaee-cafe/rest/coffees/1
curl -H &quot;Accept: application/json&quot; $VM_IP:8080/javaee-cafe/rest/coffees
</code></pre></div><p>注意 <code>cappuccino</code> 已删除。</p> <h1 id="清理资源"><a href="#清理资源" class="header-anchor">#</a> 清理资源</h1> <p>探索完应用程序后，您可以删除资源。 由于我们使用了资源组，因此执行单个命令很容易。</p> <blockquote><p><em>请注意，这将删除该组中的所有资源，包括您在教程中创建的资源（虚拟机，Postgres等），如果资源组是</em> 之前创建 <em>，资源组中的其他服务实例也会删除</em></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>az group delete --name $AZURE_RESOURCE_GROUP_NAME
</code></pre></div><h1 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h1> <p>您已通过学习如何在 Azure 中部署 Java EE 应用程序，掌握了使用虚拟机和托管数据库部属应用服务器，提供长期持久性支持。</p> <p>如前所述，每个选项都有其优缺点。 在这种情况下，您可以完全控制应用程序，部署基础结构，扩展方式等。另一方面，请记住，管理基础结构、调整应用大小、安全防护等应用程序功能，是同交付核心业务价值一样，必须承担的一系列责任。</p> <p>下一部分将深入探讨如何使用Docker容器平台来部署Java EE应用程序。 敬请关注！</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/shinyzhu/azureselected/edit/master/zh-cn/content/cloud-advocate/2019-12/deploying-java-ee-apps-to-azure-part-1.md" target="_blank" rel="noopener noreferrer">在 GitHub 编辑本页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">最近更新于:</span> <span class="time">3/9/2020, 8:31:50 AM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/azureselected/zh-cn/content/cloud-advocate/2020-01/deploying-java-ee-apps-to-azure-part-2.html">
        部署 Java EE 应用到 Azure: 第 2 部分
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/azureselected/assets/js/app.8a0b7483.js" defer></script><script src="/azureselected/assets/js/2.8d021b4d.js" defer></script><script src="/azureselected/assets/js/39.b70a599f.js" defer></script><script src="/azureselected/assets/js/3.32c85e2e.js" defer></script><script src="/azureselected/assets/js/5.554b9b17.js" defer></script>
  </body>
</html>
